<Page x:Class="UiDesktopApp1.Views.Pages.SanPhamPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
      xmlns:local="clr-namespace:UiDesktopApp1.Views.Pages"
      mc:Ignorable="d" 
      d:DataContext="{d:DesignInstance local:SanPhamPage,
                                 IsDesignTimeCreatable=False}"
      d:DesignHeight="450" d:DesignWidth="800"
      Title="SanPhamPage">

    <StackPanel>
        <Border Padding="16" BorderBrush="#DDD" BorderThickness="0,0,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
                    <ui:AutoSuggestBox Icon="{ui:SymbolIcon Search24}"
                                       PlaceholderText="Tìm kiếm"
                                       Text="{Binding SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                       Width="200" Height="35"
                                       OriginalItemsSource="{Binding AllProducts, Mode=OneWay}" 
                                       UpdateTextOnSelect="True">
                        <ui:AutoSuggestBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Margin="8,6">
                                    <Image Source="{Binding }" Width="32" Height="35" Margin="0,0,8,0"/>
                                    <StackPanel>
                                        <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                                        <TextBlock Text="{Binding Code}" Opacity=".6" FontSize="12"/>
                                    </StackPanel>
                                </StackPanel>
                            </DataTemplate>
                        </ui:AutoSuggestBox.ItemTemplate>
                    </ui:AutoSuggestBox>
                    <ComboBox ItemsSource="{Binding Categories}"
                              DisplayMemberPath="Name"
                              SelectedItem="{Binding SelectedCategory, Mode=TwoWay}"
                              Height="Auto" Width="Auto" 
                              Margin="10,0,0,0">
                        
                    </ComboBox>
                    <ui:Button Content="Làm mới" 
                               Command="{Binding LoadDataCommand}"
                               Height="36" Margin="10,0,0,0">
                        <ui:Button.Icon>
                            <ui:SymbolIcon Symbol="ArrowClockwise20"/>
                        </ui:Button.Icon>
                    </ui:Button>
                </StackPanel>

                <Grid Grid.Row="1">
                    <ui:DataGrid ItemsSource="{Binding ProductsView}"
                         AutoGenerateColumns="False"
                         CanUserAddRows="False"
                         CanUserDeleteRows="False"    
                         CanUserResizeColumns="False"
                         CanUserResizeRows="False"
                         CanUserReorderColumns="False"
                         IsReadOnly="True"
                         SelectionMode="Single"
                         HeadersVisibility="All"
                         RowHeight="56"
                         AlternatingRowBackground="#F8F9FB"
                         BorderThickness="1"
                         BorderBrush="#DDD">

                        <!-- Style mặc định -->
                        <ui:DataGrid.TextColumnElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="FontSize" Value="13"/>
                                <Setter Property="Padding" Value="8,0"/>
                                <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                            </Style>
                        </ui:DataGrid.TextColumnElementStyle>

                        <ui:DataGrid.Columns>
                            <DataGridTemplateColumn Header="Hình ảnh" Width="90">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border Padding="4">
                                            <ui:Image Source="{Binding Image}"
                                                      Width="48"
                                                      Height="48"
                                                      CornerRadius="6" BorderBrush="#33000000"
                                                      Stretch="UniformToFill"
                                                      VerticalAlignment="Center"
                                                      HorizontalAlignment="Center"
                                                      ClipToBounds="True"
                                                      SnapsToDevicePixels="True"
                                                      RenderOptions.BitmapScalingMode="HighQuality"/>
                                        </Border>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTextColumn Header="Tên" Binding="{Binding ProductName}" Width="*" />
                            <DataGridTextColumn Header="Tồn kho" Binding="{Binding InitialQty}" Width="Auto" />
                            <DataGridTextColumn Header="Giá vốn" Binding="{Binding CostPrice, StringFormat={}{0:N0} ₫}" Width="Auto" />
                            <DataGridTextColumn Header="Giá bán" Binding="{Binding SalePrice, StringFormat={}{0:N0} ₫}" Width="Auto" />
                            <DataGridTextColumn Header="Mã số" Binding="{Binding ProductCode}" Width="Auto" />
                            <DataGridTextColumn Header="Ngày hết hạn" Binding="{Binding ExpiryDate, StringFormat={}{0:dd/MM/yyyy}}" Width="Auto" />
                        </ui:DataGrid.Columns>
                    </ui:DataGrid>
                </Grid>
            </Grid>

        </Border>
    </StackPanel>
</Page>
